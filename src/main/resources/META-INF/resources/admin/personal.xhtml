<!DOCTYPE html>
<h:html xmlns="http://www.w3.org/1999/xhtml"
        xmlns:h="http://xmlns.jcp.org/jsf/html"
        xmlns:f="http://xmlns.jcp.org/jsf/core"
        xmlns:p="http://primefaces.org/ui">
    <h:head>
        <title>Gestión de Personal</title>
        <link rel="stylesheet" href="https://unpkg.com/primeflex@latest/primeflex.css"/>
        <link rel="stylesheet" href="https://unpkg.com/primeflex@latest/themes/primeone-dark.css"/>
    </h:head>
    <h:body style="background: #f5f5f5; min-height: 100vh;">
        <div class="p-4">
            <div class="border-round p-shadow-3 p-4 mb-4" style="background-color: white;">
                <div class="flex justify-content-between align-items-center">
                    <h1 class="text-3xl font-bold" style="color: #333;">
                        <i class="pi pi-users mr-2" style="color: #e67e22;"></i>
                        Gestión de Personal
                    </h1>
                    <p:button value="Volver al Menú"
                              icon="pi pi-arrow-left"
                              outcome="menuAdmin.xhtml"
                              styleClass="p-button-secondary"/>
                </div>
            </div>

            <h:form id="formPersonal">
                <p:messages/>

                <div class="border-round p-shadow-3 p-4 mb-3" style="background-color: white;">
                    <div class="flex justify-content-between align-items-center">
                        <h3>Personal por Zona</h3>
                        <p:commandButton value="Asignar Personal a Zona"
                                         icon="pi pi-user-plus"
                                         update=":dialogAsignar"
                                         oncomplete="PF('dlgAsignar').show()"
                                         styleClass="p-button-success"/>
                    </div>
                </div>

                <div class="border-round p-shadow-3 p-4" style="background-color: white;">
                    <p:dataTable value="#{personalAdminControllerWeb.trabajadores}"
                                 var="tm"
                                 paginator="true"
                                 rows="15"
                                 emptyMessage="No hay personal asignado">

                        <p:column headerText="ID">
                            <h:outputText value="#{tm.staff.personalId}"/>
                        </p:column>

                        <p:column headerText="Nombre">
                            <h:outputText value="#{tm.staff.name} #{tm.staff.lastname}"/>
                        </p:column>

                        <p:column headerText="Teléfono">
                            <h:outputText value="#{tm.staff.number}"/>
                        </p:column>

                        <p:column headerText="Email">
                            <h:outputText value="#{tm.staff.email}"/>
                        </p:column>

                        <p:column headerText="Estado">
                            <p:badge value="#{tm.staff.state}"/>
                        </p:column>

                        <p:column headerText="Zona">
                            <h:outputText value="#{tm.municipality.zone}"/>
                        </p:column>
                    </p:dataTable>
                </div>
            </h:form>

            <p:dialog id="dialogAsignar"
                      header="Asignar Personal a Zona"
                      widgetVar="dlgAsignar"
                      modal="true"
                      width="500">
                <h:form>
                    <div class="flex flex-column gap-3 p-4">
                        <h:outputLabel value="Seleccionar Personal" style="font-weight: bold;"/>
                        <p:selectOneMenu value="#{personalAdminControllerWeb.personalSeleccionado}"
                                         styleClass="w-full">
                            <f:selectItem itemLabel="Seleccione personal" itemValue=""/>
                            <f:selectItems value="#{personalAdminControllerWeb.personalDisponible}"
                                           var="p"
                                           itemLabel="#{p.name} #{p.lastname}"
                                           itemValue="#{p.personalId}"/>
                        </p:selectOneMenu>

                        <h:outputLabel value="Seleccionar Municipalidad" style="font-weight: bold;"/>
                        <p:selectOneMenu value="#{personalAdminControllerWeb.municipalidadSeleccionada}"
                                         styleClass="w-full">
                            <f:selectItem itemLabel="Seleccione zona" itemValue=""/>
                            <f:selectItems value="#{personalAdminControllerWeb.municipalidades}"
                                           var="m"
                                           itemLabel="#{m.zone} - #{m.location}"
                                           itemValue="#{m.municipalidadId}"/>
                        </p:selectOneMenu>
                    </div>

                    <f:facet name="footer">
                        <p:commandButton value="Asignar"
                                         icon="pi pi-check"
                                         action="#{personalAdminControllerWeb.asignarPersonalAZona()}"
                                         update=":formPersonal"
                                         oncomplete="PF('dlgAsignar').hide()"
                                         styleClass="p-button-success"/>
                        <p:commandButton value="Cancelar"
                                         icon="pi pi-times"
                                         onclick="PF('dlgAsignar').hide()"
                                         type="button"
                                         styleClass="p-button-secondary"/>
                    </f:facet>
                </h:form>
            </p:dialog>
        </div>
    </h:body>
</h:html>